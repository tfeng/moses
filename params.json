{"name":"moses.js","tagline":"Moses Statistical Machine Translation (SMT) library for Node.js","body":"moses.js\r\n==========\r\n\r\n### Moses Statistical Machine Translation (SMT) library for Node.js\r\n\r\n[Moses](http://www.statmt.org/moses/) is a statistical machine translation system written in C++. This module enables usage of Moses in Node.js using the JavaScript language. In addition, it also adds the capability of loading multiple translation systems into the same node process. This means the same process (or web server built with node and [express](http://expressjs.com/)) can hold multiple distinctly different translation models (e.g., Chinese to English in IT and English to French in medicine) at the same time, and be able to use those models to translate user-given sentences or paragraphs on-demand.\r\n\r\nMoses Installation\r\n----------\r\n\r\nThe installation process is a little tricky, because this module depends on Moses, and Moses has a few dependencies. The instructions below originally come from Moses' [Moses Installation and Training Run-Through](http://www.statmt.org/moses_steps.html) page.\r\n\r\n### Mac OSX\r\n\r\nSupposing `$WORK` (which may be set to `$HOME/translation`) is the directory to hold source and build files, and `$TRANSLATION` (which may be set to `/opt/translation`) is the directory where executables, libraries and header files are to be stored.\r\n\r\nBefore proceeding, Xcode must be installed. After installing Xcode, launch it, and install `Command Line Tools` in `Xcode -> Preferences -> Downloads -> Components tab`. This will provide the standard build tool for command line usage (with some modifications).\r\n\r\n#### MacPorts\r\n\r\n[MacPorts](http://www.macports.org/) is provides additional necessary build tools. After installing MacPorts, install autoconf and automake.\r\n\r\n```bash\r\n$ sudo /opt/local/bin/port install autoconf automake\r\n```\r\n\r\n#### Boost\r\n\r\nDownload latest version of Boost library from [boost.org](http://www.boost.org/). Suppose the package is `$WORK/boost_1_54_0.tar.gz`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ tar -zxvf boost_1_54_0.tar.gz\r\n$ cd boost_1_54_0\r\n$ ./bootstrap.sh --prefix=$TRANSLATION/boost\r\n$ sudo ./b2 install\r\n```\r\n\r\n#### GIZA++\r\n\r\nDownload the latest version of [GIZA++](https://code.google.com/p/giza-pp/). Suppose the package is `$WORK/giza-pp-v1.0.7.tar.gz`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ tar -zxvf giza-pp-v1.0.7.tar.gz\r\n$ cd giza-pp\r\n$ make\r\n$ sudo mkdir -p $TRANSLATION/giza-pp/bin\r\n$ sudo cp GIZA++-v2/{GIZA++,snt2cooc.out} mkcls-v2/mkcls $TRANSLATION/giza-pp/bin\r\n```\r\n\r\n#### SRILM\r\n\r\nDownload the latest version of [SRILM](http://www.speech.sri.com/projects/srilm/). Suppose the package is `$WORK/srilm.tgz`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ mkdir srilm\r\n$ tar -zxvf srilm.tgz -C srilm\r\n$ env SRILM=`pwd` make\r\n$ sudo mkdir $TRANSLATION/srilm\r\n$ sudo cp -r {bin,include,lib} $TRANSLATION/srilm\r\n$ cd $TRANSLATION/srilm\r\n$ sudo ln -s lib/macosx lib64\r\n```\r\n\r\n#### IRSTLM\r\n\r\nDownload the latest version of [IRSTLM](http://hlt.fbk.eu/en/irstlm). Suppose the package is `$WORK/irstlm-5.80.03.tgz`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ tar -zxvf irstlm-5.80.03.tgz\r\n$ ./regenerate-makefiles.sh\r\n$ ./configure --prefix=$TRANSLATION/irstlm\r\n$ make\r\n$ sudo make install\r\n```\r\n\r\n#### Moses\r\n\r\nDownload [Moses release 1.0](https://github.com/moses-smt/mosesdecoder/tree/RELEASE-1.0) (with the Download ZIP button). Suppose the package is `$WORK/mosesdecoder-RELEASE-1.0.zip`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ unzip mosesdecoder-RELEASE-1.0.zip\r\n$ cd mosesdecoder-RELEASE-1.0\r\n$ ./bjam --with-srilm=$TRANSLATION/srilm --with-irstlm=$TRANSLATION/irstlm --with-giza=$TRANSLATION/giza-pp --with-boost=$TRANSLATION/boost --prefix=$TRANSLATION/moses -j2 -sLDFLAGS=\"-liconv -lboost_program_options\"\r\n$ sudo ./bjam --with-srilm=$TRANSLATION/srilm --with-irstlm=$TRANSLATION/irstlm --with-giza=$TRANSLATION/giza-pp --with-boost=$TRANSLATION/boost --prefix=$TRANSLATION/moses -j2 -sLDFLAGS=\"-liconv -lboost_program_options\" install\r\n```\r\n\r\n#### Environment\r\n\r\nThe following script sets up the environment for running the command-line tools.\r\n\r\n```bash\r\n#!/bin/sh\r\n\r\nwhere=$TRANSLATION\r\n\r\nDYLD_LIBRARY_PATH=\r\nfor lib in $where/*/lib; do\r\n  if [ x\"$DYLD_LIBRARY_PATH\" == x ]; then\r\n    DYLD_LIBRARY_PATH=$lib\r\n  else\r\n    DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$lib\r\n  fi\r\ndone\r\nexport DYLD_LIBRARY_PATH\r\n\r\nfor bin in $where/*/bin $where/*/bin/macosx; do\r\n  PATH=$bin:$PATH\r\ndone\r\nexport PATH\r\n\r\nexport BOOST=$where/boost\r\nexport MOSES=$where/moses\r\nexport SRILM=$where/srilm\r\n```\r\n\r\nPut this file in `$TRANSLATION/setenv.sh`. With this, each time a new command-line console is open, execute the following command to set up.\r\n\r\n```bash\r\n$ . $TRANSLATION/setenv.sh\r\n```\r\n\r\n#### Testing Moses\r\n\r\nDownload Moses' [sample models package](http://www.statmt.org/moses/download/sample-models.tgz). Suppose the package is `$WORK/sample-models.tgz`.\r\n\r\n```bash\r\n$ cd $WORK\r\n$ tar -zxvf sample-models.tgz\r\n$ cd sample-models\r\n$ . $TRANSLATION/setenv.sh\r\n$ moses -f phrase-model/moses.ini < phrase-model/in\r\n```\r\n\r\nIf all is set up correctly, near the end of the output, there should be a line containing text `BEST TRANSLATION: this is a small house`.\r\n\r\nmoses.js Installation\r\n----------\r\n\r\n#### Patching Moses\r\n\r\nAs of release 1.0, Moses supports only one translation system per OS process. After the system is initialized, all subsequent translation must be performed in the same system. Though advanced features such as [Using Multiple Translation Systems in the Same Server](http://www.statmt.org/moses/?n=Moses.AdvancedFeatures#ntoc29) and [Alternate Weight Settings](http://www.statmt.org/moses/?n=Moses.AdvancedFeatures#ntoc52) allow users to have multiple translation tables, all those tables must be loaded at the same time, and once loaded, they cannot be changed in the entire life of the process.\r\n\r\nA patch shipped with moses.js provides an enhancement that allows users to create and destroy translation systems on demand. This is especially useful for a Node.js server that runs for an extended period of time, and is expected to update its translation system dynamically (e.g., as result of a user request or service update). The patch also enables loading multiple translation systems at the same time, and selecting one of them for use with any given translation task.\r\n\r\nTo apply the patch, download [the latest version from moses.js' github server](https://raw.github.com/tfeng/moses/master/patches/moses-1.0.patch). Suppose the patch file is saved at `$WORK/moses-1.0.patch`.\r\n\r\n```bash\r\n$ cd $WORK/mosesdecoder-RELEASE-1.0\r\n$ patch -p1 < ../moses-1.0.patch\r\n$ sudo ./bjam --with-srilm=$TRANSLATION/srilm --with-irstlm=$TRANSLATION/irstlm --with-giza=$TRANSLATION/giza-pp --with-boost=$TRANSLATION/boost --prefix=$TRANSLATION/moses -j2 -sLDFLAGS=\"-liconv -lboost_program_options\" install\r\n```\r\n\r\nThis will rebuild Moses and reinstall it in `$TRANSLATION/moses`. After this, it is recommended to return to [Testing Moses](#testing-moses) to test moses again. The patch also modifies the main `moses` program so that it runs in the legacy single-translation-system mode, instead of the enhanced multi-translation-system mode.\r\n\r\n#### Install Moses header files\r\n\r\nMoses installation does not include header files required for building moses.js. Those files need to be manually copied to the installation directory.\r\n\r\n```bash\r\n$ sudo rm -rf $TRANSLATION/moses/include\r\n$ sudo mkdir $TRANSLATION/moses/include\r\n$ sudo cp -R $WORK/mosesdecoder-RELEASE-1.0/headers-moses $TRANSLATION/moses/include/moses\r\n$ sudo cp -R $WORK/mosesdecoder-RELEASE-1.0/headers-base/* $TRANSLATION/moses/include/\r\n```\r\n\r\n#### Installing moses.js\r\n\r\nInstall latest release of moses.js from [npm](https://npmjs.org/package/moses).\r\n\r\n```bash\r\n$ cd $WORK\r\n$ mkdir test-moses-js\r\n$ . $TRANSLATION/setenv.sh\r\n$ npm install moses\r\n$ node node_modules/moses/sample/test-phrase-model.js\r\n> Defined parameters (per moses.ini or switch):\r\n\tconfig: phrase-model/moses.ini \r\n\tinput-factors: 0 \r\n\tlmodel-file: 8 0 3 lm/europarl.srilm.gz \r\n\tmapping: T 0 \r\n\tn-best-list: nbest.txt 100 \r\n\tttable-file: 0 0 0 1 phrase-model/phrase-table \r\n\tttable-limit: 10 \r\n\tweight-d: 1 \r\n\tweight-l: 1 \r\n\tweight-t: 1 \r\n\tweight-w: 0 \r\nOverwriting parameter verbose (the parameter does not have previous values) with the following values: 0\r\nStarted.\r\n> this is a small house\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}